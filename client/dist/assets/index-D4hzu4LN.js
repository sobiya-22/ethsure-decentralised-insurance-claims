import{a9 as X,_ as l,Z as q,aa as Ee,a8 as g,$ as Y,ab as M,ac as me,ad as Se,J as ye,ae as Ie,af as Q,ag as J,ah as x,ai as T,S as C,aj as G,ak as b,al as j,am as Te}from"./index-B_tSOIix.js";function D(){}const te="SYN",k="ACK",ie="BRK";class ne extends X.Duplex{constructor({name:e,target:t,targetWindow:n=window,targetOrigin:i="*"}){if(super({objectMode:!0}),l(this,"_init",void 0),l(this,"_haveSyn",void 0),l(this,"_name",void 0),l(this,"_target",void 0),l(this,"_targetWindow",void 0),l(this,"_targetOrigin",void 0),l(this,"_onMessage",void 0),l(this,"_synIntervalId",void 0),!e||!t)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=e,this._target=t,this._targetWindow=n,this._targetOrigin=i,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(ie,null,D),this._haveSyn=!1,this._init=!1}_handShake(){this._write(te,null,D),this.cork()}_onData(e){if(!this._init)e===te?(this._haveSyn=!0,this._write(k,null,D)):e===k&&(this._init=!0,this._haveSyn||this._write(k,null,D),this.uncork());else if(e===ie)this._break();else try{this.push(e)}catch(t){this.emit("error",t)}}_postMessage(e){const t=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},t)}onMessage(e){const t=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof t!="object"||t.target!==this._name||!t.data||this._onData(t.data)}_read(){}_write(e,t,n){this._postMessage(e),n()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}class Ae extends X.Duplex{constructor({parent:e,name:t}){super({objectMode:!0}),l(this,"_parent",void 0),l(this,"_name",void 0),this._parent=e,this._name=t}_read(){}_write(e,t,n){this._parent.push({name:this._name,data:e}),n()}}var U={exports:{}},$,re;function Oe(){if(re)return $;re=1,$=o;function o(e,t){if(e&&t)return o(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(i){n[i]=e[i]}),n;function n(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];var r=e.apply(this,i),c=i[i.length-1];return typeof r=="function"&&r!==c&&Object.keys(c).forEach(function(f){r[f]=c[f]}),r}}return $}var se;function ee(){if(se)return U.exports;se=1;var o=Oe();U.exports=o(e),U.exports.strict=o(t),e.proto=e(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return e(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return t(this)},configurable:!0})});function e(n){var i=function(){return i.called?i.value:(i.called=!0,i.value=n.apply(this,arguments))};return i.called=!1,i}function t(n){var i=function(){if(i.called)throw new Error(i.onceError);return i.called=!0,i.value=n.apply(this,arguments)},s=n.name||"Function wrapped with `once`";return i.onceError=s+" shouldn't be called more than once",i.called=!1,i}return U.exports}var V,oe;function pe(){if(oe)return V;oe=1;var o=ee(),e=function(){},t=globalThis.Bare?queueMicrotask:process.nextTick.bind(process),n=function(r){return r.setHeader&&typeof r.abort=="function"},i=function(r){return r.stdio&&Array.isArray(r.stdio)&&r.stdio.length===3},s=function(r,c,f){if(typeof c=="function")return s(r,null,c);c||(c={}),f=o(f||e);var u=r._writableState,v=r._readableState,w=c.readable||c.readable!==!1&&r.readable,a=c.writable||c.writable!==!1&&r.writable,m=!1,h=function(){r.writable||p()},p=function(){a=!1,w||f.call(r)},_=function(){w=!1,a||f.call(r)},E=function(P){f.call(r,P?new Error("exited with error code: "+P):null)},y=function(P){f.call(r,P)},O=function(){t(A)},A=function(){if(!m){if(w&&!(v&&v.ended&&!v.destroyed))return f.call(r,new Error("premature close"));if(a&&!(u&&u.ended&&!u.destroyed))return f.call(r,new Error("premature close"))}},R=function(){r.req.on("finish",p)};return n(r)?(r.on("complete",p),r.on("abort",O),r.req?R():r.on("request",R)):a&&!u&&(r.on("end",h),r.on("close",h)),i(r)&&r.on("exit",E),r.on("end",_),r.on("finish",p),c.error!==!1&&r.on("error",y),r.on("close",O),function(){m=!0,r.removeListener("complete",p),r.removeListener("abort",O),r.removeListener("request",R),r.req&&r.req.removeListener("finish",p),r.removeListener("end",h),r.removeListener("close",h),r.removeListener("finish",p),r.removeListener("exit",E),r.removeListener("end",_),r.removeListener("error",y),r.removeListener("close",O)}};return V=s,V}var Ce=pe();const ae=q(Ce);var be=ee();const Re=q(be);var B,ce;function Pe(){if(ce)return B;ce=1;var o=ee(),e=pe(),t;try{t=Ee}catch{}var n=function(){},i=typeof process>"u"?!1:/^v?\.0/.test(process.version),s=function(a){return typeof a=="function"},r=function(a){return!i||!t?!1:(a instanceof(t.ReadStream||n)||a instanceof(t.WriteStream||n))&&s(a.close)},c=function(a){return a.setHeader&&s(a.abort)},f=function(a,m,h,p){p=o(p);var _=!1;a.on("close",function(){_=!0}),e(a,{readable:m,writable:h},function(y){if(y)return p(y);_=!0,p()});var E=!1;return function(y){if(!_&&!E){if(E=!0,r(a))return a.close(n);if(c(a))return a.abort();if(s(a.destroy))return a.destroy();p(y||new Error("stream was destroyed"))}}},u=function(a){a()},v=function(a,m){return a.pipe(m)},w=function(){var a=Array.prototype.slice.call(arguments),m=s(a[a.length-1]||n)&&a.pop()||n;if(Array.isArray(a[0])&&(a=a[0]),a.length<2)throw new Error("pump requires two streams per minimum");var h,p=a.map(function(_,E){var y=E<a.length-1,O=E>0;return f(_,y,O,function(A){h||(h=A),A&&p.forEach(u),!y&&(p.forEach(u),m(h))})});return a.reduce(v)};return B=w,B}var Ne=Pe();const le=q(Ne),de=Symbol("IGNORE_SUBSTREAM");class We extends X.Duplex{constructor(e={}){super(g(g({},e),{},{objectMode:!0})),l(this,"_substreams",void 0),l(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new Ae({parent:this,name:e});return this._substreams[e]=t,Le(this,n=>t.destroy(n||void 0)),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=de}_read(){}_write(e,t,n){const{name:i,data:s}=e;if(!i)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const r=this._substreams[i];return r?(r!==de&&r.push(s),n()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${i}"`),n())}}function Le(o,e){const t=Re(e);ae(o,{readable:!1},t),ae(o,{writable:!1},t)}const De={height:660,width:375},Ue={height:700,width:1200},Me={height:700,width:450},xe="setup_complete",N={IFRAME_STATUS:"iframe_status",CLOSE_WINDOW:"close_window",USER_LOGGED_IN:"user_logged_in",USER_LOGGED_OUT:"user_logged_out",TOGGLE_WIDGET_BUTTON:"toggle_widget_button",ALLOW_WALLET_SERVICE:"allow_wallet_service"},I={LOGOUT:"logout",WALLET_INSTANCE_ID:"wallet_instance_id",USER_INFO:"user_info",SET_PROVIDER:"set_provider",TOPUP:"topup",IFRAME_STATUS:"iframe_status",CLOSED_WINDOW:"closed_window",WINDOW_BLOCKED:"window_blocked",GET_PROVIDER_STATE:"get_provider_state",LOGIN_WITH_PRIVATE_KEY:"login_with_private_key",SHOW_WALLET_CONNECT:"show_wallet_connect",SHOW_CHECKOUT:"show_checkout",SHOW_WALLET_UI:"show_wallet_ui",SHOW_SWAP:"show_swap",LOGIN_WITH_SESSION_ID:"login_with_session_id"},we={GET_PROVIDER_STATE:"wallet_get_provider_state",WALLET_SWITCH_CHAIN:"wallet_switchChain"},z={ACCOUNTS_CHANGED:"wallet_accounts_changed",CHAIN_CHANGED:"wallet_chain_changed",UNLOCK_STATE_CHANGED:"wallet_unlock_state_changed"};function qe(o){return function(t,n,i){i(s=>{n.error&&Y.warn(`Error in RPC response:
`,n),!t.isTorusInternal&&(Y.info(`RPC (${o.origin}):`,t,"->",n),s())})}}function ge(o){return o!==null&&typeof o=="object"&&typeof o.pipe=="function"}function Fe(o){return ge(o)&&o.writable!==!1&&typeof o._write=="function"&&typeof o._writableState=="object"}function He(o){return ge(o)&&o.readable!==!1&&typeof o._read=="function"&&typeof o._readableState=="object"}function Ge(o){return Fe(o)&&He(o)}var S={errors:{disconnected:()=>"Web3Auth: Lost connection to Web3Auth.",permanentlyDisconnected:()=>"Web3Auth: Disconnected from iframe. Page reload required.",unsupportedSync:o=>`Web3Auth: The Web3Auth Ethereum provider does not support synchronous methods like ${o} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:o=>`Invalid options. Received: { maxEventListeners: ${o}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:o=>`'args.logger' must include required method '${o}'.`},info:{connected:o=>`Web3Auth: Connected to chain with ID "${o}".`}},d=Y.getLogger("ws-embed");function je(){return(o,e,t)=>{(typeof o.method!="string"||!o.method)&&(e.error=M.invalidRequest({message:"The request 'method' must be a non-empty string.",data:g(g({},o||{}),{},{cause:"The request 'method' must be a non-empty string."})})),t(n=>{const{error:i}=e;return i&&d.error(`Ws-Embed - RPC Error: ${i.message}`,i),n()})}}function ke(o,e,t){let n=`Web3Auth: Lost connection to "${o}".`;e!=null&&e.stack&&(n+=`
${e.stack}`),d.warn(n),t&&t.listenerCount("error")>0&&t.emit("error",n)}const $e=["eth_subscription"];class _e extends me{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"}){if(super(),l(this,"rpcEngine",void 0),l(this,"jsonRpcConnectionEvents",void 0),l(this,"isWeb3Auth",void 0),l(this,"state",void 0),!Ge(e))throw new Error(S.errors.invalidDuplexStream());this.isWeb3Auth=!0,this.setMaxListeners(t),this.handleConnect=this.handleConnect.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.handleStreamDisconnect=this.handleStreamDisconnect.bind(this),this.rpcRequest=this.rpcRequest.bind(this),this.initializeState=this.initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this),this.send=this.send.bind(this);const i=new We;le(e,i,e,this.handleStreamDisconnect.bind(this,"Web3Auth")),i.ignoreStream("phishing");const s=Se();le(s.stream,i.createStream(n),s.stream,this.handleStreamDisconnect.bind(this,"Web3Auth RpcProvider"));const r=new ye;r.push(Ie()),r.push(je()),r.push(qe({origin:location.origin})),r.push(s.middleware),this.rpcEngine=r,this.jsonRpcConnectionEvents=s.events}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw M.invalidRequest({message:S.errors.invalidRequestArgs(),data:g(g({},e||{}),{},{cause:S.errors.invalidRequestArgs()})});const{method:t,params:n}=e;if(typeof t!="string"||t.length===0)throw M.invalidRequest({message:S.errors.invalidRequestMethod(),data:g(g({},e||{}),{},{cause:S.errors.invalidRequestArgs()})});if(n!==void 0&&!Array.isArray(n)&&(typeof n!="object"||n===null))throw M.invalidRequest({message:S.errors.invalidRequestParams(),data:g(g({},e||{}),{},{cause:S.errors.invalidRequestArgs()})});return new Promise((i,s)=>{this.rpcRequest({method:t,params:n},Q(i,s))})}send(e,t){this.rpcRequest(e,t)}sendAsync(e){return new Promise((t,n)=>{this.rpcRequest(e,Q(t,n))})}handleStreamDisconnect(e,t){ke(e,t,this),this.handleDisconnect(!1,t?t.message:void 0)}}const W={PRODUCTION:"production",STAGING:"staging",DEVELOPMENT:"development",TESTING:"testing"},L={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"};class Ve extends me{constructor({url:e,target:t,features:n,timeout:i=3e4}){super(),l(this,"url",void 0),l(this,"target",void 0),l(this,"features",void 0),l(this,"window",void 0),l(this,"windowTimer",void 0),l(this,"iClosedWindow",void 0),l(this,"timeout",void 0),this.url=e,this.target=t||"_blank",this.features=n||J(Ue),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=i,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;this.window=window.open(this.url.href,this.target,this.features),(e=this.window)!==null&&e!==void 0&&e.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}class F extends _e{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"},i){super(e,{maxEventListeners:t,jsonRpcStreamName:n}),l(this,"tryWindowHandle",void 0),l(this,"windowRefs",void 0),l(this,"iframeUrl",void 0),l(this,"iframeId",void 0),this.state=g(g({},F.defaultState),i),this.iframeUrl="",this.iframeId="",this.windowRefs=new Map,this.on("connect",()=>{this.state.isConnected=!0});const s=r=>{const{method:c,params:f}=r;if(c===N.IFRAME_STATUS){const{isFullScreen:u,rid:v}=f;this.displayIframe({isFull:u,rid:v},!0)}else if(c===N.CLOSE_WINDOW)this.handleCloseWindow(f);else if(c===N.USER_LOGGED_IN){const{currentAuthConnection:u}=f;this.state.isLoggedIn=!0,this.state.currentAuthConnection=u}else if(c===N.USER_LOGGED_OUT)this.state.isLoggedIn=!1,this.state.currentAuthConnection=null,this.displayIframe({isFull:!1},!0);else if(c===N.TOGGLE_WIDGET_BUTTON){const{show:u}=f;this.state.widgetVisibility=u,this.displayIframe()}else if(c===N.ALLOW_WALLET_SERVICE){const{allow:u}=f;this.state.allowWalletService=u}};this.jsonRpcConnectionEvents.on("notification",s)}get isLoggedIn(){return this.state.isLoggedIn}get isIFrameFullScreen(){return this.state.isIFrameFullScreen}get allowWalletService(){return this.state.allowWalletService}isConnected(){return this.state.isConnected}async initializeState(e){try{const{torusUrl:t,torusIframeId:n}=e;this.iframeUrl=t,this.iframeId=n;const{currentAuthConnection:i,isLoggedIn:s}=await this.request({method:I.GET_PROVIDER_STATE,params:[]});s&&this.handleConnect(i,s)}catch(t){d.error("Web3Auth: Failed to get initial state. Please report this bug.",t)}finally{d.info("initialized communication state"),this.state.initialized=!0}}displayIframe({isFull:e=!1,rid:t=""}={},n=!1){const i={};if(e)i.display="block",i.width="100%",i.height="100%",i.top="0px",i.right="0px",i.left="0px",i.bottom="0px";else switch(i.display=this.state.widgetVisibility?"block":"none",i.height=this.state.widgetVisibility?"70px":"0px",i.width=this.state.widgetVisibility?"70px":"0px",this.state.buttonPosition){case L.TOP_LEFT:i.top="0px",i.left="0px",i.right="auto",i.bottom="auto";break;case L.TOP_RIGHT:i.top="0px",i.right="0px",i.left="auto",i.bottom="auto";break;case L.BOTTOM_RIGHT:i.bottom="0px",i.right="0px",i.top="auto",i.left="auto";break;case L.BOTTOM_LEFT:default:i.bottom="0px",i.left="0px",i.top="auto",i.right="auto";break}const s=document.getElementById(this.iframeId);Object.assign(s.style,i),this.state.isIFrameFullScreen=e,n||this.request({method:I.IFRAME_STATUS,params:{isIFrameFullScreen:e,rid:t}})}async handleWindow(e,{url:t,target:n,features:i,timeout:s}={}){const r=new URL(t||`${this.iframeUrl}/redirect?windowId=${e}&sessionNamespace=${window.location.hostname}`),c=new Ve({url:r,target:n,features:i,timeout:s});if(c.open(),!c.window){this.displayIframe({isFull:!0}),this.request({method:I.WINDOW_BLOCKED,params:{windowId:e,finalUrl:r.href}});return}this.windowRefs.set(e,c),c.once("close",()=>{this.windowRefs.delete(e),this.request({method:I.CLOSED_WINDOW,params:{windowId:e}})})}rpcRequest(e,t){const n=t,i=e;Array.isArray(i)||i.jsonrpc||(i.jsonrpc="2.0"),this.rpcEngine.handle(i,n)}handleConnect(e,t){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{currentAuthConnection:e,isLoggedIn:t}),d.debug(S.info.connected(e)))}handleDisconnect(e,t){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new x(1013,t||S.errors.disconnected()),d.debug(n)):(n=new x(1011,t||S.errors.permanentlyDisconnected()),d.error(n),this.state.currentAuthConnection=null,this.state.isLoggedIn=!1,this.state.widgetVisibility=!1,this.state.isIFrameFullScreen=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleCloseWindow(e){const{windowId:t}=e;this.windowRefs.has(t)&&(this.windowRefs.get(t).close(),this.windowRefs.delete(t))}}l(F,"defaultState",{buttonPosition:"bottom-left",currentAuthConnection:null,isIFrameFullScreen:!1,widgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1,hasEmittedConnection:!1,allowWalletService:!1});const Be=o=>{const e=window.document.createElement("template"),t=o.trim();return e.innerHTML=t,e.content.firstChild};var K,ue;function ze(){return ue||(ue=1,K=function o(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,i,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(!o(e[i],t[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[i]))return!1;for(i=n;i--!==0;){var r=s[i];if(!o(e[r],t[r]))return!1}return!0}return e!==e&&t!==t}),K}var Ke=ze();const Ye=q(Ke);class H extends _e{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"}){super(e,{maxEventListeners:t,jsonRpcStreamName:n}),l(this,"chainId",void 0),l(this,"selectedAddress",void 0),l(this,"tryWindowHandle",void 0),this.state=g({},H.defaultState),this.selectedAddress=null,this.chainId=null,this.handleAccountsChanged=this.handleAccountsChanged.bind(this),this.handleChainChanged=this.handleChainChanged.bind(this),this.handleUnlockStateChanged=this.handleUnlockStateChanged.bind(this),this.on("connect",()=>{this.state.isConnected=!0});const i=s=>{const{method:r,params:c}=s;r===z.ACCOUNTS_CHANGED?this.handleAccountsChanged(c):r===z.UNLOCK_STATE_CHANGED?this.handleUnlockStateChanged(c):r===z.CHAIN_CHANGED?this.handleChainChanged(c):$e.includes(r)&&(this.emit("data",s),this.emit("notification",c.result),this.emit("message",{type:r,data:c}))};this.jsonRpcConnectionEvents.on("notification",i)}isConnected(){return this.state.isConnected}async initializeState(){try{const{accounts:e,chainId:t,isUnlocked:n}=await this.request({method:we.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:t}),this.handleChainChanged({chainId:t}),this.handleUnlockStateChanged({accounts:e,isUnlocked:n}),this.handleAccountsChanged(e)}catch(e){d.error("WsEmbed: Failed to get initial state. Please report this bug.",e)}finally{d.info("initialized provider state"),this.state.initialized=!0}}rpcRequest(e,t,n=!1){let i=t;const s=e;if(!Array.isArray(s)){if(s.jsonrpc||(s.jsonrpc="2.0"),[T.GET_ACCOUNTS,T.ETH_REQUEST_ACCOUNTS,C.SOLANA_REQUEST_ACCOUNTS,C.GET_ACCOUNTS].includes(s.method))i=(r,c)=>{this.handleAccountsChanged(c.result||[],s.method==="eth_accounts",n),t(r,c)};else if(s.method==="wallet_getProviderState"){this.rpcEngine.handle(e,i);return}}this.tryWindowHandle(s,i)}handleConnect(e){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{chainId:e}),d.debug(S.info.connected(e)))}handleDisconnect(e,t){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new x(1013,t||S.errors.disconnected()),d.debug(n)):(n=new x(1011,t||S.errors.permanentlyDisconnected()),d.error(n),this.chainId=null,this.state.accounts=null,this.selectedAddress=null,this.state.isUnlocked=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleAccountsChanged(e,t=!1,n=!1){let i=e;Array.isArray(i)||(d.error("WsEmbed: Received non-array accounts parameter. Please report this bug.",i),i=[]);for(const s of e)if(typeof s!="string"){d.error("WsEmbed: Received non-string account. Please report this bug.",e),i=[];break}Ye(this.state.accounts,i)||(t&&Array.isArray(this.state.accounts)&&this.state.accounts.length>0&&!n&&d.error('WsEmbed: "eth_accounts" unexpectedly updated accounts. Please report this bug.',i),this.state.accounts=i,this.emit("accountsChanged",i)),this.selectedAddress!==i[0]&&(this.selectedAddress=i[0]||null)}handleChainChanged({chainId:e}={}){if(!e){d.error("WsEmbed: Received invalid network parameters. Please report this bug.",{chainId:e});return}e==="loading"?this.handleDisconnect(!0):(this.handleConnect(e),e!==this.chainId&&(this.chainId=e,this.state.initialized&&this.emit("chainChanged",this.chainId)))}handleUnlockStateChanged({accounts:e,isUnlocked:t}={}){if(typeof t!="boolean"){d.error("WsEmbed: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:t});return}t!==this.state.isUnlocked&&(this.state.isUnlocked=t,this.handleAccountsChanged(e||[]))}}l(H,"defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function he(o){return new Promise((e,t)=>{try{const n=document.createElement("img");n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=o}catch(n){t(n)}})}const Qe=o=>{const{document:e}=o,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const n=e.querySelector('head > meta[name="title"]');return n?n.content:e.title&&e.title.length>0?e.title:o.location.hostname};async function Je(o){try{const{document:e}=o;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await he(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(n=>!!n.href),t&&await he(t.href))?t.href:""}catch{return""}}const Ze=async()=>({name:Qe(window),icon:await Je(window)}),Xe="5.0.22",fe=`v${Xe.split(".")[0]}`,Z={[W.TESTING]:{url:"https://develop-wallet.web3auth.io",logLevel:"debug"},[W.DEVELOPMENT]:{url:"http://localhost:4050",logLevel:"debug"},[W.STAGING]:{url:`https://staging-wallet.web3auth.io/${fe}`,logLevel:"debug"},[W.PRODUCTION]:{url:`https://wallet.web3auth.io/${fe}`,logLevel:"error"}};(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{url:t}=Z.production;e.href=`${t}/frame`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){d.warn(e)}})();const et=new Set([C.SEND_TRANSACTION,C.SIGN_MESSAGE,C.SIGN_TRANSACTION,C.SIGN_ALL_TRANSACTIONS,T.ETH_SIGN,T.ETH_SIGN_TYPED_DATA_V4,T.PERSONAL_SIGN,T.ETH_TRANSACTION,T.ADD_CHAIN,T.SWITCH_CHAIN,we.WALLET_SWITCH_CHAIN]);class it{constructor({modalZIndex:e=99999,web3AuthClientId:t,web3AuthNetwork:n}){l(this,"isInitialized",void 0),l(this,"modalZIndex",void 0),l(this,"provider",void 0),l(this,"communicationProvider",void 0),l(this,"buttonPosition",void 0),l(this,"web3AuthClientId",void 0),l(this,"web3AuthNetwork",void 0),l(this,"isPluginMode",void 0),l(this,"confirmationStrategy",void 0),l(this,"buildEnv",void 0),l(this,"embedNonce",G()),this.isInitialized=!1,this.modalZIndex=e,this.web3AuthClientId=t,this.web3AuthNetwork=n}get isLoggedIn(){var e;return((e=this.communicationProvider)===null||e===void 0?void 0:e.isLoggedIn)||!1}get getBuildEnv(){return this.buildEnv}async init({buildEnv:e=W.PRODUCTION,enableLogging:t=!1,chains:n,chainId:i,walletUrls:s,whiteLabel:r,confirmationStrategy:c=b.DEFAULT,accountAbstractionConfig:f,enableKeyExport:u=!1}){if(this.isInitialized)throw new Error("Already initialized");if(!(r?.logoDark&&r?.logoLight))throw new Error("Dapp logo is required to be set in whiteLabel");this.buildEnv=e,this.confirmationStrategy=c;const{url:w,logLevel:a}=s&&s[e]?g(g({},Z[e]),s[e]):Z[e];d.info(w,"url loaded"),d.setDefaultLevel(a),t?d.enableAll():d.disableAll();const m=new URL(w);m.pathname.endsWith("/")?m.pathname+="frame":m.pathname+="/frame";const h=new URLSearchParams;h.append("origin",window.location.origin),h.append("nonce",this.embedNonce),m.hash=h.toString();const p=this.getTheme(r?.mode||j.light),_=Be(`<iframe
        id="walletIframe-${this.embedNonce}"
        class="walletIframe-${this.embedNonce}"
        sandbox="allow-popups allow-scripts allow-same-origin allow-forms allow-modals allow-downloads"
        src="${m.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()};
        color-scheme: ${p}"
        allow="clipboard-write"
      ></iframe>`);this.buttonPosition=r?.buttonPosition||L.BOTTOM_LEFT;const E=await Ze();return new Promise((y,O)=>{try{window.document.body.appendChild(_);const A=async R=>{if(R.origin!==m.origin)return;const{message:P,nonce:ve}=R.data||{};P===xe&&ve===this.embedNonce&&(window.removeEventListener("message",A),_.contentWindow.postMessage({chains:n,chainId:i,dappMetadata:E,enableLogging:t,web3AuthClientId:this.web3AuthClientId,web3AuthNetwork:this.web3AuthNetwork,whiteLabel:r,confirmationStrategy:c,accountAbstractionConfig:f,enableKeyExport:u},m.origin),await this.setupWeb3({torusUrl:w,walletIframe:_}),this.isInitialized=!0,y())};window.addEventListener("message",A)}catch(A){O(A)}})}async login(e={}){if(!this.isInitialized)throw new Error("Call init() first");const t=this.communicationProvider.isIFrameFullScreen;try{!e.authConnection&&!t&&this.communicationProvider.displayIframe({isFull:!0});const n=await new Promise((i,s)=>{const c=Object.values(Te).includes(this.provider.chainId)?C.SOLANA_REQUEST_ACCOUNTS:T.ETH_REQUEST_ACCOUNTS;this.provider.rpcRequest({method:c,params:[e.authConnection,e.login_hint]},Q(i,s))});if(d.info("check: res",n),Array.isArray(n)&&n.length>0)return this.confirmationStrategy===b.AUTO_APPROVE&&d.warn("Confirmation strategy auto approve is not allowed on Embed Mode, using Default instead."),n;throw new Error("Login failed")}catch(n){throw d.error("login failed",n),n}finally{t||this.communicationProvider.displayIframe({isFull:!1})}}async loginWithSessionId(e){if(!this.isInitialized)throw new Error("Call init() first");if(!e.sessionId)throw new Error("sessionId is required");try{const t=await this.communicationProvider.request({method:I.LOGIN_WITH_SESSION_ID,params:[e.sessionId,e.sessionNamespace||""]});if(d.info("check: res",t),t.success)return this.isPluginMode=!0,this.confirmationStrategy===b.POPUP&&d.warn("Confirmation strategy popup is not allowed on Plugin Mode, using Default instead."),t.success;throw new Error("Login failed")}catch(t){throw d.error("login with session id failed",t),t}}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:I.LOGOUT,params:[]})}async cleanUp(){var e;(e=this.communicationProvider)!==null&&e!==void 0&&e.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(n){return n instanceof Element||n instanceof Document}const t=window.document.getElementById(`walletIframe-${this.embedNonce}`);e(t)&&t.remove(),this.isInitialized=!1}async getUserInfo(){return await this.communicationProvider.request({method:I.USER_INFO,params:[]})}async showWalletConnectScanner(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:I.SHOW_WALLET_CONNECT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showWalletUi(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:I.SHOW_WALLET_UI,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showCheckout(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:I.SHOW_CHECKOUT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showSwap(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:I.SHOW_SWAP,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}getConfirmationStrategyFinal(e){let t=this.confirmationStrategy;return!Array.isArray(e)&&et.has(e.method)&&this.confirmationStrategy!==b.MODAL&&!this.isPluginMode&&(t=b.POPUP),t}getTheme(e){return e===j.light?"light":e===j.dark||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async setupWeb3(e){d.info("setupWeb3 running");const t=new ne({name:"embed_torus",target:"iframe_torus",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),n=new ne({name:"embed_communication",target:"iframe_communication",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),i=new H(t,{}),s=new F(n,{},{buttonPosition:this.buttonPosition});i.tryWindowHandle=(u,v)=>{const w=u,a=this.getConfirmationStrategyFinal(u),{allowWalletService:m}=s;if(a===b.POPUP&&m){const h=G();s.handleWindow(h,{target:"_blank",features:J(Me),timeout:500}),w.windowId=h}i.rpcEngine.handle(w,v)},s.tryWindowHandle=(u,v)=>{const w=u,a=this.getConfirmationStrategyFinal(u),{allowWalletService:m}=s;if(a===b.POPUP&&m){const h=G();s.handleWindow(h,{target:"_blank",features:J(De),timeout:500}),w.params.windowId=h}s.rpcEngine.handle(w,v)};const r=u=>{const v=i[u],w=this;i[u]=function(m,h){const{method:p,params:_=[]}=m;if(p===T.ETH_REQUEST_ACCOUNTS||p===C.SOLANA_REQUEST_ACCOUNTS){if(!h)return w.login({authConnection:_[0]});w.login({authConnection:_[0]}).then(E=>h(null,E)).catch(E=>h(E))}return v.apply(this,[m,h])}};r("request"),r("sendAsync"),r("send");const c=new Proxy(i,{deleteProperty:()=>!0}),f=new Proxy(s,{deleteProperty:()=>!0});this.provider=c,this.communicationProvider=f,d.info("test setupWeb3 "),await Promise.all([i.initializeState(),s.initializeState(g(g({},e),{},{torusIframeId:e.walletIframe.id}))]),d.debug("WsEmbed - injected provider")}}export{L as BUTTON_POSITION,b as CONFIRMATION_STRATEGY,T as EVM_METHOD_TYPES,Te as SOLANA_CHAIN_IDS,C as SOLANA_METHOD_TYPES,H as TorusInPageProvider,W as WS_EMBED_BUILD_ENV,it as default};
